{% extends 'base.html' %}
{% load static %}

{% block title %}My Account | Barizi{% endblock %}

{% block content %}
  <div class="container py-5">
    <div class="row">
    <!-- Sidebar -->
      <div class="col-lg-3 mb-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="text-center mb-4">
              <div class="avatar-wrapper mb-3">
                {% if request.user.profile.avatar %}
                  <img src="{{ request.user.profile.avatar.url }}" alt="Profile Picture" class="rounded-circle img-fluid" style="width: 100px; height: 100px; object-fit: cover;">
                {% else %}
                  <img src="{% static 'images/one.jpg' %}" alt="Profile Picture" class="rounded-circle img-fluid" style="width: 100px; height: 100px; object-fit: cover;">
                {% endif %}
              </div>
              <h5 class="mb-1">{{ request.user.get_full_name|default:request.user.username }}</h5>
              <p class="text-muted small mb-0">{{ request.user.email }}</p>
            </div>

            <div class="list-group list-group-flush" id="account-tabs">
              <a href="#profile-tab" class="list-group-item list-group-item-action border-0 px-0 active" data-bs-toggle="tab" role="tab">
                <i class="bi bi-person me-2"></i> My Profile
              </a>
              <a href="#options-tab" class="list-group-item list-group-item-action border-0 px-0" data-bs-toggle="tab" role="tab">
                <i class="bi bi-person me-2"></i> Options
              </a>
              <a href="#settings-tab" class="list-group-item list-group-item-action border-0 px-0" data-bs-toggle="tab" role="tab">
                <i class="bi bi-gear me-2"></i> Settings
              </a>
              <a href="" class="list-group-item list-group-item-action border-0 px-0 text-danger">
                <i class="bi bi-box-arrow-right me-2"></i> Logout
              </a>
            </div>
          </div>
        </div>
      </div>

    <!-- Main Content -->
      <div class="col-lg-9">
        <div class="tab-content">
          <!-- Profile Tab -->
          <div class="tab-pane fade show active" id="profile-tab" role="tabpanel">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white py-3">
                <h5 class="mb-0">Profile information</h5>
              </div>

              {% comment %} tabs {% endcomment %}
              {% comment %} tabs {% endcomment %}
              <div class="card-body">
                <!-- Settings Tabs -->
                <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="basic-information" data-bs-toggle="tab" data-bs-target="#basicInformation" type="button" role="tab" aria-controls="basicInformation" aria-selected="true">Basic Information</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="contact-tab" data-bs-toggle="tab" data-bs-target="#contact" type="button" role="tab" aria-controls="contact" aria-selected="false">Contact & Location</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab" aria-controls="details" aria-selected="false">Details & Features</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="faqs-tab" data-bs-toggle="tab" data-bs-target="#faqs" type="button" role="tab" aria-controls="faqs" aria-selected="false">FAQs</button>
                  </li>
                </ul>

                <!-- Profile Tab Content -->
                <div class="tab-content" id="settingsTabsContent">
                <!-- Basic Information -->
                  <div class="tab-pane fade show active" id="basicInformation" role="tabpanel" aria-labelledby="basic-information">
                    <form id="add-listing-form" method="post" enctype="multipart/form-data">
                      {% csrf_token %}
                      <!-- Basic Information -->
                      <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Basic Information</h5>
                        <div class="row g-3">
                          <div class="col-12 mb-3">
                            <label class="form-label">Profile Picture</label>
                            <div class="d-flex align-items-center">
                              <div class="position-relative me-3">
                                {% if request.user.profile.avatar %}
                                  <img src="{{ request.user.profile.avatar.url }}" alt="Profile Picture" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                                {% else %}
                                  <img src="{% static 'images/one.jpg' %}" alt="Profile Picture" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
                                {% endif %}
                                <button class="btn btn-sm btn-primary position-absolute bottom-0 end-0 rounded-circle" style="width: 32px; height: 32px;">
                                  <i class="bi bi-pencil"></i>
                                </button>
                              </div>
                              <div class="flex-grow-1">
                                <input class="form-control" type="file" id="profilePicture">
                                <div class="form-text">Recommended size: 300x300px. Max file size: 2MB</div>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <label for="firstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" value="{{ request.user.first_name }}">
                          </div>
                          <div class="col-md-6">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" value="{{ request.user.last_name }}">
                          </div>
                          <div class="col-md-6">
                            <label for="username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="username" value="{{ request.user.username }}" readonly>
                          </div>
                          <div class="col-md-6">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" value="{{ request.user.email }}">
                          </div>
                          <div class="col-12">
                            <label for="bio" class="form-label">Bio</label>
                            <textarea class="form-control" id="bio" rows="4" placeholder="Tell us about yourself or your business">{{ request.user.profile.bio|default:'' }}</textarea>
                          </div>
                          
                          <div class="col-12">
                            <label for="listing-category" class="form-label">Category <span class="text-danger">*</span></label>
                            <select class="form-select" id="listing-category" name="category" required>
                              <option value="">Select Category</option>
                              <option value="restaurant">Restaurant</option>
                              <option value="hotel">Hotel</option>
                              <option value="shop">Shop</option>
                              <option value="fitness">Fitness</option>
                              <option value="beauty">Beauty</option>
                              <option value="education">Education</option>
                              <option value="real-estate">Real Estate</option>
                              <option value="automotive">Automotive</option>
                              <option value="entertainment">Entertainment</option>
                            </select>
                          </div>

                          {% comment %} <div class="col-md-6">
                            <label for="listing-subcategory" class="form-label" disabled>Sub-Category</label>
                            <select class="form-select" id="listing-subcategory" name="subcategory">
                              <option value="" disabled>Select Sub-Category</option>
                              <!-- Dynamic options will be loaded based on category selection -->
                            </select>
                          </div> {% endcomment %}

                          <div class="col-12 mt-5">
                            <button type="submit" class="btn btn-primary">Save</button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>

                  <!-- Notifications Tab -->
                  <div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
                    <form id="add-listing-form" method="post" enctype="multipart/form-data">
                      {% csrf_token %}
                      <!-- Contact Details -->
                      <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Contact Details</h5>
                        <div class="row g-3">
                          <div class="col-md-6">
                            <label for="listing-phone" class="form-label">Phone Number <span class="text-danger">*</span></label>
                            <input type="tel" class="form-control" id="listing-phone" name="phone" required>
                          </div>

                          <div class="col-md-6">
                            <label for="listing-email" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="listing-email" name="email" required>
                          </div>

                          <div class="col-md-6">
                            <label for="listing-website" class="form-label">Website</label>
                            <input type="url" class="form-control" id="listing-website" name="website" placeholder="https://example.com">
                          </div>

                          <div class="col-md-6">
                            <label for="listing-social" class="form-label">Social Media</label>
                            <div class="input-group">
                              <span class="input-group-text"><i class="bi bi-facebook"></i></span>
                              <input type="text" class="form-control" id="listing-social" name="facebook" placeholder="Facebook URL">
                            </div>
                          </div>

                          <div class="col-md-6">
                            <label class="form-label d-block">&nbsp;</label>
                            <div class="input-group">
                              <span class="input-group-text"><i class="bi bi-twitter"></i></span>
                              <input type="text" class="form-control" name="twitter" placeholder="Twitter URL">
                            </div>
                          </div>

                          <div class="col-md-6">
                            <label class="form-label d-block">&nbsp;</label>
                            <div class="input-group">
                              <span class="input-group-text"><i class="bi bi-instagram"></i></span>
                              <input type="text" class="form-control" name="instagram" placeholder="Instagram URL">
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Location -->
                      <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Location</h5>
                        <div class="row g-3">
                          <div class="col-md-12">
                            <label for="listing-address" class="form-label">Address <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="listing-address" name="address" required>
                          </div>

                          <div class="col-md-6">
                            <label for="listing-city" class="form-label">City <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="listing-city" name="city" required>
                          </div>

                          <div class="col-md-6">
                            <label for="listing-state" class="form-label">State/Province <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="listing-state" name="state" required>
                          </div>

                          <div class="col-md-6">
                            <label for="listing-zip" class="form-label">Zip/Postal Code <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="listing-zip" name="zip" required>
                          </div>

                          <div class="col-md-6">
                            <label for="listing-country" class="form-label">Country <span class="text-danger">*</span></label>
                            <select class="form-select" id="listing-country" name="country" required>
                              <option value="">Select Country</option>
                              <option value="US">United States</option>
                              <option value="CA">Canada</option>
                              <option value="UK">United Kingdom</option>
                              <option value="AU">Australia</option>
                              <option value="KE">Kenya</option>
                              <!-- Add more countries as needed -->
                            </select>
                          </div>

                          <div class="col-md-12">
                            <div class="form-check">
                              <input class="form-check-input" type="checkbox" id="show-map" name="show_map" checked>
                              <label class="form-check-label" for="show-map">
                                Show Map
                              </label>
                            </div>
                          </div>

                          <div class="col-md-12">
                            <div class="border p-3 rounded" style="height: 300px; background-color: #f8f9fa;">
                              <p class="text-center text-muted mb-0 d-flex align-items-center justify-content-center h-100">
                                <i class="bi bi-map me-2"></i> Map will be displayed here
                              </p>
                            </div>
                          </div>
                        </div>
                      </div>
                    </form>

                    <button type="submit" class="btn btn-primary">Save Preferences</button>
                  </div>

                  <!-- Privacy Tab -->
                  <div class="tab-pane fade" id="details" role="tabpanel" aria-labelledby="details-tab">
                    <form id="add-listing-form" method="post" enctype="multipart/form-data">
                      {% csrf_token %}
                      <!-- Details & Features -->
                      <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Details & Features</h5>
                        <div class="row g-3">
                          <div class="col-md-6">
                            <label for="listing-price-range" class="form-label">Price Range</label>
                            <select class="form-select" id="listing-price-range" name="price_range">
                              <option value="">Select Price Range</option>
                              <option value="$">$ (Inexpensive)</option>
                              <option value="$$">$$ (Moderate)</option>
                              <option value="$$$">$$$ (Expensive)</option>
                              <option value="$$$$">$$$$ (Very Expensive)</option>
                            </select>
                          </div>

                          <div class="col-md-6">
                            <label for="listing-establishment-year" class="form-label">Establishment Year</label>
                            <input type="number" class="form-control" id="listing-establishment-year" name="establishment_year" min="1900" max="2099">
                          </div>

                          <div class="col-md-12">
                            <label class="form-label">Amenities & Features</label>
                            <div class="row g-2">
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-wifi" name="features" value="wifi">
                                  <label class="form-check-label" for="feature-wifi">Free WiFi</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-parking" name="features" value="parking">
                                  <label class="form-check-label" for="feature-parking">Parking</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-ac" name="features" value="ac">
                                  <label class="form-check-label" for="feature-ac">Air Conditioning</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-card" name="features" value="card">
                                  <label class="form-check-label" for="feature-card">Credit Cards</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-delivery" name="features" value="delivery">
                                  <label class="form-check-label" for="feature-delivery">Delivery</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-takeout" name="features" value="takeout">
                                  <label class="form-check-label" for="feature-takeout">Takeout</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-reservations" name="features" value="reservations">
                                  <label class="form-check-label" for="feature-reservations">Reservations</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-outdoor" name="features" value="outdoor">
                                  <label class="form-check-label" for="feature-outdoor">Outdoor Seating</label>
                                </div>
                              </div>
                              <div class="col-md-4">
                                <div class="form-check">
                                  <input class="form-check-input" type="checkbox" id="feature-wheelchair" name="features" value="wheelchair">
                                  <label class="form-check-label" for="feature-wheelchair">Wheelchair Accessible</label>
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="col-md-12">
                            <label for="listing-tags" class="form-label">Tags (separate with commas)</label>
                            <input type="text" class="form-control" id="listing-tags" name="tags" placeholder="restaurant, food, pizza">
                          </div>
                        </div>
                      </div>

                      <!-- Opening Hours -->
                      <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Opening Hours</h5>
                        <div class="row g-3">
                          <div class="col-md-12">
                            <div class="form-check mb-2">
                              <input class="form-check-input" type="checkbox" id="always-open" name="always_open">
                              <label class="form-check-label" for="always-open">
                                Always Open (24/7)
                              </label>
                            </div>
                          </div>

                          <div class="col-md-12" id="hours-container">
                            <div class="row mb-2 align-items-center">
                              <div class="col-md-3">
                                <label class="form-label">Monday</label>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="monday_open">
                                  <option value="">Opening Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <option value="00:30">12:30 AM</option>
                                  <option value="01:00">1:00 AM</option>
                                  <option value="01:30">1:30 AM</option>
                                  <!-- Add more time options -->
                                  <option value="12:00">12:00 PM</option>
                                  <option value="12:30">12:30 PM</option>
                                  <option value="13:00">1:00 PM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="monday_close">
                                  <option value="">Closing Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <option value="00:30">12:30 AM</option>
                                  <option value="01:00">1:00 AM</option>
                                  <option value="01:30">1:30 AM</option>
                                  <!-- Add more time options -->
                                  <option value="12:00">12:00 PM</option>
                                  <option value="12:30">12:30 PM</option>
                                  <option value="13:00">1:00 PM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                            </div>

                            <div class="row mb-2 align-items-center">
                              <div class="col-md-3">
                                <label class="form-label">Tuesday</label>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="tuesday_open">
                                  <option value="">Opening Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="tuesday_close">
                                  <option value="">Closing Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                    <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                            </div>

                            <div class="row mb-2 align-items-center">
                              <div class="col-md-3">
                                <label class="form-label">Wednesday</label>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="wednesday_open">
                                  <option value="">Opening Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="wednesday_close">
                                  <option value="">Closing Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                            </div>

                            <div class="row mb-2 align-items-center">
                              <div class="col-md-3">
                                <label class="form-label">Thursday</label>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="thursday_open">
                                  <option value="">Opening Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="thursday_close">
                                  <option value="">Closing Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                            </div>

                            <div class="row mb-2 align-items-center">
                              <div class="col-md-3">
                                <label class="form-label">Friday</label>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="friday_open">
                                  <option value="">Opening Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="friday_close">
                                  <option value="">Closing Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                            </div>

                            <div class="row mb-2 align-items-center">
                              <div class="col-md-3">
                                <label class="form-label">Saturday</label>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="saturday_open">
                                  <option value="">Opening Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="saturday_close">
                                  <option value="">Closing Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                            </div>

                            <div class="row mb-2 align-items-center">
                              <div class="col-md-3">
                                <label class="form-label">Sunday</label>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="sunday_open">
                                  <option value="">Opening Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                              <div class="col-md-4">
                                <select class="form-select" name="sunday_close">
                                  <option value="">Closing Time</option>
                                  <option value="closed">Closed</option>
                                  <option value="00:00">12:00 AM</option>
                                  <!-- Add more time options -->
                                  <option value="23:30">11:30 PM</option>
                                </select>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Images & Gallery -->
                      <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Images & Gallery</h5>
                        <div class="row g-3">
                          <div class="col-md-12">
                            <label class="form-label">Featured Image <span class="text-danger">*</span></label>
                            <div class="border rounded p-3 text-center">
                              <img src="" alt="Featured Image Preview" id="featured-image-preview" class="img-fluid mb-3" style="display: none; max-height: 200px;">
                              <label class="btn btn-outline-primary mb-0">
                                <i class="bi bi-cloud-arrow-up me-2"></i> Upload Featured Image
                                <input type="file" name="featured_image" id="featured-image-input" class="d-none" accept="image/*" required>
                              </label>
                              <div class="form-text mt-2">Recommended size: 800x600 pixels</div>
                            </div>
                          </div>


                        </div>
                      </div>




                    </form>
                    <button type="submit" class="btn btn-primary">Save Privacy Settings</button>
                  </div>

                  <!-- Connected Accounts Tab -->
                  <div class="tab-pane fade" id="faqs" role="tabpanel" aria-labelledby="faqs-tab">
                    <form id="add-listing-form" method="post" enctype="multipart/form-data">
                      {% csrf_token %}

                      <!-- FAQ Section -->
                      <div class="mb-4">
                        <h5 class="border-bottom pb-2 mb-3">Frequently Asked Questions</h5>
                        <div class="row g-3">
                          <div class="col-md-12">
                            <div class="card mb-3">
                              <div class="card-body">
                                <h6 class="card-title">FAQ 1</h6>
                                <div class="row g-3">
                                  <div class="col-md-12">
                                    <label class="form-label">Question</label>
                                    <input type="text" class="form-control" name="faq_question[]" placeholder="e.g., Do you offer delivery?">
                                  </div>
                                  <div class="col-md-12">
                                    <label class="form-label">Answer</label>
                                    <textarea class="form-control" name="faq_answer[]" rows="2" placeholder="e.g., Yes, we offer delivery within a 5-mile radius."></textarea>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div id="faq-container">
                          <!-- Additional FAQs will be added here -->
                            </div>

                            <button type="button" class="btn btn-outline-secondary" id="add-faq">
                              <i class="bi bi-plus-lg me-1"></i> Add Another FAQ
                            </button>
                          </div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              {% comment %} tabs {% endcomment %}
              {% comment %} tabs {% endcomment %}

            </div>
          </div>

          <!-- Settings Tab -->
          <div class="tab-pane fade" id="options-tab" role="tabpanel">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white py-3">
                <h5 class="mb-0">Account Settings</h5>
              </div>
              <div class="card-body">
                <form id="add-listing-form" method="post" enctype="multipart/form-data">
                  {% csrf_token %}

                  <!-- Listing Options -->
                  <div class="mb-4">
                    <h5 class="border-bottom pb-2 mb-3">Listing Options</h5>
                    <div class="row g-3">
                      <div class="col-md-12">
                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox" id="featured-listing" name="featured">
                          <label class="form-check-label" for="featured-listing">
                            Feature this listing (may require additional payment)
                          </label>
                        </div>

                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox" id="verified-listing" name="verified">
                          <label class="form-check-label" for="verified-listing">
                            Mark as verified business (requires verification)
                          </label>
                        </div>

                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox" id="hide-address" name="hide_address">
                          <label class="form-check-label" for="hide-address">
                            Hide exact address on listing
                          </label>
                        </div>

                        <div class="form-check mb-2">
                          <input class="form-check-input" type="checkbox" id="allow-reviews" name="allow_reviews" checked>
                          <label class="form-check-label" for="allow-reviews">
                            Allow reviews and ratings
                          </label>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Terms & Conditions -->
                  <div class="mb-4">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="terms-agree" name="terms_agree" required>
                      <label class="form-check-label" for="terms-agree">
                        I agree to the <a href="#" target="_blank">Terms and Conditions</a> and <a href="#" target="_blank">Privacy Policy</a>
                      </label>
                    </div>
                  </div>

                  <!-- Submit Buttons -->
                  <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">Submit Listing</button>
                    <button type="submit" name="save_draft" value="1" class="btn btn-outline-secondary">Save as Draft</button>
                    <button type="reset" class="btn btn-outline-danger">Reset Form</button>
                  </div>
                </form>
              </div>
            </div>
          </div>


          <!-- Settings Tab -->
          <div class="tab-pane fade" id="settings-tab" role="tabpanel">
            <div class="card border-0 shadow-sm">
              <div class="card-header bg-white py-3">
                <h5 class="mb-0">Account Settings</h5>
              </div>
              <div class="card-body">
                <!-- Settings Tabs -->
                <ul class="nav nav-tabs mb-4" id="settingsTabs" role="tablist">
                  <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="password-tab" data-bs-toggle="tab" data-bs-target="#password" type="button" role="tab" aria-controls="password" aria-selected="true">Password</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="notifications-tab" data-bs-toggle="tab" data-bs-target="#notifications" type="button" role="tab" aria-controls="notifications" aria-selected="false">Notifications</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="privacy-tab" data-bs-toggle="tab" data-bs-target="#privacy" type="button" role="tab" aria-controls="privacy" aria-selected="false">Privacy</button>
                  </li>
                  <li class="nav-item" role="presentation">
                    <button class="nav-link" id="connected-tab" data-bs-toggle="tab" data-bs-target="#connected" type="button" role="tab" aria-controls="connected" aria-selected="false">Connected Accounts</button>
                  </li>
                </ul>

                <!-- Settings Tab Content -->
                <div class="tab-content" id="settingsTabsContent">
                <!-- Password Tab -->
                  <div class="tab-pane fade show active" id="password" role="tabpanel" aria-labelledby="password-tab">
                    <form>
                      <div class="mb-3">
                        <label for="currentPassword" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="currentPassword">
                      </div>
                      <div class="mb-3">
                        <label for="newPassword" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="newPassword">
                        <div class="form-text">Password must be at least 8 characters and include a number and a special character.</div>
                      </div>
                      <div class="mb-4">
                        <label for="confirmPassword" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirmPassword">
                      </div>
                      <button type="submit" class="btn btn-primary">Update Password</button>
                    </form>
                  </div>

                <!-- Notifications Tab -->
                  <div class="tab-pane fade" id="notifications" role="tabpanel" aria-labelledby="notifications-tab">
                    <div class="mb-4">
                      <h6>Email Notifications</h6>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="newMessage" checked>
                        <label class="form-check-label" for="newMessage">New messages</label>
                      </div>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="newBooking" checked>
                        <label class="form-check-label" for="newBooking">Booking requests</label>
                      </div>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="listingUpdates" checked>
                        <label class="form-check-label" for="listingUpdates">Listing updates</label>
                      </div>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="promotions">
                        <label class="form-check-label" for="promotions">Promotions and offers</label>
                      </div>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="newsletter" checked>
                        <label class="form-check-label" for="newsletter">Newsletter</label>
                      </div>
                    </div>

                    <div class="mb-4">
                      <h6>Push Notifications</h6>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="pushMessages" checked>
                        <label class="form-check-label" for="pushMessages">New messages</label>
                      </div>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="pushBookings" checked>
                        <label class="form-check-label" for="pushBookings">Booking requests</label>
                      </div>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="pushUpdates">
                        <label class="form-check-label" for="pushUpdates">Listing updates</label>
                      </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Preferences</button>
                  </div>

                <!-- Privacy Tab -->
                  <div class="tab-pane fade" id="privacy" role="tabpanel" aria-labelledby="privacy-tab">
                    <div class="mb-4">
                      <h6>Profile Visibility</h6>
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="profileVisibility" id="visibilityPublic" checked>
                        <label class="form-check-label" for="visibilityPublic">
                          Public - Anyone can view your profile
                        </label>
                      </div>
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="profileVisibility" id="visibilityRegistered">
                        <label class="form-check-label" for="visibilityRegistered">
                          Registered Users - Only registered users can view your profile
                        </label>
                      </div>
                      <div class="form-check mb-2">
                        <input class="form-check-input" type="radio" name="profileVisibility" id="visibilityPrivate">
                        <label class="form-check-label" for="visibilityPrivate">
                          Private - Only you can view your profile
                        </label>
                      </div>
                    </div>

                    <div class="mb-4">
                      <h6>Contact Information</h6>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="showEmail" checked>
                        <label class="form-check-label" for="showEmail">Show email on profile</label>
                      </div>
                      <div class="form-check form-switch mb-2">
                        <input class="form-check-input" type="checkbox" id="showPhone" checked>
                        <label class="form-check-label" for="showPhone">Show phone number on profile</label>
                      </div>
                    </div>

                    <div class="mb-4">
                      <h6>Data Management</h6>
                      <p class="text-muted small mb-3">These actions are permanent and cannot be undone.</p>
                      <div class="d-flex gap-2">
                        <!-- Delete Account Modal -->
                        <button type="button" class="btn btn-outline-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                          Delete Account
                        </button>
                        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                          <div class="modal-dialog">
                            <div class="modal-content">
                              <div class="modal-header">
                                <h5 class="modal-title" id="deleteModalLabel">Delete Account</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                              </div>
                              <div class="modal-body">
                                <div class="alert alert-danger">
                                  <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                  <strong>Warning:</strong> This action cannot be undone.
                                </div>
                                <p>Deleting your account will permanently remove all your data, including:</p>
                                <ul>
                                  <li>Your profile information</li>
                                  <li>Your listings and bookmarks</li>
                                  <li>Your messages and reviews</li>
                                  <li>All other account data</li>
                                </ul>
                                <div class="mb-3">
                                  <label for="deleteConfirm" class="form-label">To confirm, please type "DELETE" in the field below:</label>
                                  <input type="text" class="form-control" id="deleteConfirm" placeholder="Type DELETE">
                                </div>
                                <div class="mb-3">
                                  <label for="deletePassword" class="form-label">Enter your password:</label>
                                  <input type="password" class="form-control" id="deletePassword">
                                </div>
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-danger" disabled>Delete Account</button>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Privacy Settings</button>
                  </div>

                <!-- Connected Accounts Tab -->
                  <div class="tab-pane fade" id="connected" role="tabpanel" aria-labelledby="connected-tab">
                    <div class="mb-4">
                      <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                          <i class="bi bi-google fs-4 me-3"></i>
                          <div>
                            <h6 class="mb-0">Google</h6>
                            <p class="text-muted mb-0 small">Connected as john.doe@gmail.com</p>
                          </div>
                        </div>
                        <button class="btn btn-sm btn-outline-danger">Disconnect</button>
                      </div>

                      <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                          <i class="bi bi-facebook fs-4 me-3"></i>
                          <div>
                            <h6 class="mb-0">Facebook</h6>
                            <p class="text-muted mb-0 small">Not connected</p>
                          </div>
                        </div>
                        <button class="btn btn-sm btn-outline-primary">Connect</button>
                      </div>

                      <div class="d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                          <i class="bi bi-twitter fs-4 me-3"></i>
                          <div>
                            <h6 class="mb-0">Twitter</h6>
                            <p class="text-muted mb-0 small">Not connected</p>
                          </div>
                        </div>
                        <button class="btn btn-sm btn-outline-primary">Connect</button>
                      </div>

                      <div class="d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                          <i class="bi bi-linkedin fs-4 me-3"></i>
                          <div>
                            <h6 class="mb-0">LinkedIn</h6>
                            <p class="text-muted mb-0 small">Not connected</p>
                          </div>
                        </div>
                        <button class="btn btn-sm btn-outline-primary">Connect</button>
                      </div>
                    </div>

                    <div class="alert alert-info" role="alert">
                      <i class="bi bi-info-circle me-2"></i>
                      Connecting your social accounts allows for quicker login and helps us personalize your experience.
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
    // Initialize Bootstrap tabs
      const triggerTabList = [].slice.call(document.querySelectorAll('#account-tabs a'));
      triggerTabList.forEach(function(triggerEl) {
        triggerEl.addEventListener('click', function(event) {
          event.preventDefault();
        // Update active class on sidebar items
          document.querySelectorAll('#account-tabs a').forEach(el => el.classList.remove('active'));
          this.classList.add('active');
        });
      });

    // Add Listing Form Functionality
      const addListingForm = document.getElementById('add-listing-form');
      if (addListingForm) {
      // Featured image preview
        const featuredImageInput = document.getElementById('featured-image-input');
        const featuredImagePreview = document.getElementById('featured-image-preview');

        if (featuredImageInput) {
          featuredImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();

              reader.onload = function(e) {
                featuredImagePreview.src = e.target.result;
                featuredImagePreview.style.display = 'block';
              }

              reader.readAsDataURL(file);
            }
          });
        }

      // Gallery image preview
        const imageInputs = document.querySelectorAll('.listing-image-input');
        imageInputs.forEach(input => {
          input.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              const preview = this.closest('.image-upload-wrap').querySelector('.image-preview');

              reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
              }

              reader.readAsDataURL(file);
            }
          });
        });

      // Add more gallery images
        const addMoreBtn = document.getElementById('add-more-images');
        if (addMoreBtn) {
          addMoreBtn.addEventListener('click', function() {
            const imagesContainer = document.getElementById('listing-images-container');
            const imageCount = imagesContainer.querySelectorAll('.image-upload-wrap').length;

            if (imageCount < 5) { // Limit to 5 images
              const newImageUpload = document.createElement('div');
              newImageUpload.className = 'col-md-4 mb-3 image-upload-wrap';
              newImageUpload.innerHTML = `
              <div class="border rounded p-2 text-center position-relative">
                <img src="" alt="Preview" class="img-fluid mb-2 image-preview" style="display: none; max-height: 150px;">
                <label class="form-label w-100">
                  <span class="d-block mb-2"><i class="bi bi-cloud-arrow-up"></i> Upload Image</span>
                  <input type="file" class="form-control listing-image-input" name="gallery_images[]" accept="image/*">
                </label>
                <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1 remove-image">
                  <i class="bi bi-x"></i>
                </button>
              </div>
            `;

              imagesContainer.appendChild(newImageUpload);

            // Add event listener to new input
              const newInput = newImageUpload.querySelector('.listing-image-input');
              newInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                  const reader = new FileReader();
                  const preview = this.closest('.image-upload-wrap').querySelector('.image-preview');

                  reader.onload = function(e) {
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                  }

                  reader.readAsDataURL(file);
                }
              });

            // Add remove functionality
              const removeBtn = newImageUpload.querySelector('.remove-image');
              removeBtn.addEventListener('click', function() {
                newImageUpload.remove();

              // Re-enable add button if below limit
                if (imagesContainer.querySelectorAll('.image-upload-wrap').length < 5) {
                  addMoreBtn.disabled = false;
                }
              });
            }

            if (imagesContainer.querySelectorAll('.image-upload-wrap').length >= 5) {
              addMoreBtn.disabled = true;
            }
          });
        }

      // Add menu item functionality
        const addMenuItemBtn = document.getElementById('add-menu-item');
        if (addMenuItemBtn) {
          addMenuItemBtn.addEventListener('click', function() {
            const menuContainer = document.getElementById('menu-items-container');
            const itemCount = menuContainer.querySelectorAll('.card').length + 1;

            const newMenuItem = document.createElement('div');
            newMenuItem.className = 'card mb-3';
            newMenuItem.innerHTML = `
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="card-title mb-0">Item/Service ${itemCount + 1}</h6>
                <button type="button" class="btn btn-sm btn-outline-danger remove-menu-item">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Name</label>
                  <input type="text" class="form-control" name="menu_name[]" placeholder="e.g., Margherita Pizza">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Price</label>
                  <input type="text" class="form-control" name="menu_price[]" placeholder="e.g., $12.99">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Category</label>
                  <input type="text" class="form-control" name="menu_category[]" placeholder="e.g., Pizza">
                </div>
                <div class="col-md-12">
                  <label class="form-label">Description</label>
                  <textarea class="form-control" name="menu_description[]" rows="2" placeholder="Brief description of the item/service"></textarea>
                </div>
              </div>
            </div>
          `;

            menuContainer.appendChild(newMenuItem);

          // Add remove functionality
            const removeBtn = newMenuItem.querySelector('.remove-menu-item');
            removeBtn.addEventListener('click', function() {
              newMenuItem.remove();
            });
          });
        }

      // Add pricing plan functionality
        const addPricingPlanBtn = document.getElementById('add-pricing-plan');
        if (addPricingPlanBtn) {
          addPricingPlanBtn.addEventListener('click', function() {
            const plansContainer = document.getElementById('pricing-plans-container');
            const planCount = plansContainer.querySelectorAll('.card').length + 1;

            const newPlan = document.createElement('div');
            newPlan.className = 'card mb-3';
            newPlan.innerHTML = `
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="card-title mb-0">Plan ${planCount + 1}</h6>
                <button type="button" class="btn btn-sm btn-outline-danger remove-plan">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </div>
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label">Plan Name</label>
                  <input type="text" class="form-control" name="plan_name[]" placeholder="e.g., Basic">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Price</label>
                  <input type="text" class="form-control" name="plan_price[]" placeholder="e.g., $29.99">
                </div>
                <div class="col-md-3">
                  <label class="form-label">Duration</label>
                  <select class="form-select" name="plan_duration[]">
                    <option value="">Select Duration</option>
                    <option value="one-time">One-time</option>
                    <option value="hourly">Hourly</option>
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                  </select>
                </div>
                <div class="col-md-12">
                  <label class="form-label">Features (one per line)</label>
                  <textarea class="form-control" name="plan_features[]" rows="3" placeholder="e.g., 5 Users&#10;10GB Storage&#10;Email Support"></textarea>
                </div>
              </div>
            </div>
          `;

            plansContainer.appendChild(newPlan);

          // Add remove functionality
            const removeBtn = newPlan.querySelector('.remove-plan');
            removeBtn.addEventListener('click', function() {
              newPlan.remove();
            });
          });
        }

      // Add FAQ functionality
        const addFaqBtn = document.getElementById('add-faq');
        if (addFaqBtn) {
          addFaqBtn.addEventListener('click', function() {
            const faqContainer = document.getElementById('faq-container');
            const faqCount = faqContainer.querySelectorAll('.card').length + 1;

            const newFaq = document.createElement('div');
            newFaq.className = 'card mb-3';
            newFaq.innerHTML = `
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h6 class="card-title mb-0">FAQ ${faqCount + 1}</h6>
                <button type="button" class="btn btn-sm btn-outline-danger remove-faq">
                  <i class="bi bi-trash"></i> Remove
                </button>
              </div>
              <div class="row g-3">
                <div class="col-md-12">
                  <label class="form-label">Question</label>
                  <input type="text" class="form-control" name="faq_question[]" placeholder="e.g., Do you offer delivery?">
                </div>
                <div class="col-md-12">
                  <label class="form-label">Answer</label>
                  <textarea class="form-control" name="faq_answer[]" rows="2" placeholder="e.g., Yes, we offer delivery within a 5-mile radius."></textarea>
                </div>
              </div>
            </div>
          `;

            faqContainer.appendChild(newFaq);

          // Add remove functionality
            const removeBtn = newFaq.querySelector('.remove-faq');
            removeBtn.addEventListener('click', function() {
              newFaq.remove();
            });
          });
        }

      // Toggle opening hours based on "Always Open" checkbox
        const alwaysOpenCheckbox = document.getElementById('always-open');
        const hoursContainer = document.getElementById('hours-container');
            // Toggle opening hours based on "Always Open" checkbox
        const alwaysOpenCheckbox = document.getElementById('always-open');
        const hoursContainer = document.getElementById('hours-container');

        if (alwaysOpenCheckbox && hoursContainer) {
          alwaysOpenCheckbox.addEventListener('change', function() {
            if (this.checked) {
              hoursContainer.style.opacity = '0.5';
              hoursContainer.style.pointerEvents = 'none';

            // Disable all select elements in the hours container
              const selects = hoursContainer.querySelectorAll('select');
              selects.forEach(select => {
                select.disabled = true;
              });
            } else {
              hoursContainer.style.opacity = '1';
              hoursContainer.style.pointerEvents = 'auto';

            // Enable all select elements in the hours container
              const selects = hoursContainer.querySelectorAll('select');
              selects.forEach(select => {
                select.disabled = false;
              });
            }
          });
        }

      // Category and subcategory relationship
        const categorySelect = document.getElementById('listing-category');
        const subcategorySelect = document.getElementById('listing-subcategory');

        if (categorySelect && subcategorySelect) {
        // Define subcategories for each category
          const subcategories = {
            'restaurant': ['Cafe', 'Fast Food', 'Fine Dining', 'Pub', 'Pizzeria', 'Bakery', 'Sushi', 'Vegetarian', 'Vegan', 'Steakhouse'],
            'hotel': ['Luxury Hotel', 'Budget Hotel', 'Boutique Hotel', 'Resort', 'Motel', 'Bed & Breakfast', 'Hostel', 'Apartment', 'Villa'],
            'shop': ['Clothing', 'Electronics', 'Grocery', 'Bookstore', 'Furniture', 'Jewelry', 'Toys', 'Sports', 'Hardware', 'Gift Shop'],
            'fitness': ['Gym', 'Yoga Studio', 'CrossFit', 'Pilates', 'Martial Arts', 'Swimming Pool', 'Personal Training', 'Dance Studio'],
            'beauty': ['Hair Salon', 'Spa', 'Nail Salon', 'Barber Shop', 'Massage', 'Skincare', 'Makeup Artist'],
            'education': ['School', 'College', 'University', 'Tutoring', 'Language School', 'Cooking School', 'Driving School', 'Art School'],
            'real-estate': ['Residential', 'Commercial', 'Industrial', 'Land', 'Rental', 'Property Management'],
            'automotive': ['Car Dealership', 'Auto Repair', 'Car Wash', 'Auto Parts', 'Motorcycle', 'Rental', 'Towing'],
            'entertainment': ['Movie Theater', 'Concert Venue', 'Night Club', 'Amusement Park', 'Museum', 'Art Gallery', 'Bowling', 'Arcade']
          };

          categorySelect.addEventListener('change', function() {
            const category = this.value;

          // Clear existing options
            subcategorySelect.innerHTML = '<option value="">Select Sub-Category</option>';

          // Add new options based on selected category
            if (category && subcategories[category]) {
              subcategories[category].forEach(subcategory => {
                const option = document.createElement('option');
                option.value = subcategory.toLowerCase().replace(/\s+/g, '-');
                option.textContent = subcategory;
                subcategorySelect.appendChild(option);
              });

              subcategorySelect.disabled = false;
            } else {
              subcategorySelect.disabled = true;
            }
          });
        }

      // Form validation before submission
        addListingForm.addEventListener('submit', function(event) {
          let isValid = true;
          const requiredFields = addListingForm.querySelectorAll('[required]');

          requiredFields.forEach(field => {
            if (!field.value.trim()) {
              isValid = false;
              field.classList.add('is-invalid');

            // Create error message if it doesn't exist
              let errorDiv = field.nextElementSibling;
              if (!errorDiv || !errorDiv.classList.contains('invalid-feedback')) {
                errorDiv = document.createElement('div');
                errorDiv.className = 'invalid-feedback';
                errorDiv.textContent = 'This field is required.';
                field.parentNode.insertBefore(errorDiv, field.nextSibling);
              }
            } else {
              field.classList.remove('is-invalid');

            // Remove error message if it exists
              const errorDiv = field.nextElementSibling;
              if (errorDiv && errorDiv.classList.contains('invalid-feedback')) {
                errorDiv.remove();
              }
            }
          });

        // Check if terms checkbox is checked
          const termsCheckbox = document.getElementById('terms-agree');
          if (termsCheckbox && !termsCheckbox.checked) {
            isValid = false;
            termsCheckbox.classList.add('is-invalid');

          // Create error message if it doesn't exist
            let errorDiv = termsCheckbox.nextElementSibling.nextElementSibling;
            if (!errorDiv || !errorDiv.classList.contains('invalid-feedback')) {
              errorDiv = document.createElement('div');
              errorDiv.className = 'invalid-feedback d-block';
              errorDiv.textContent = 'You must agree to the terms and conditions.';
              termsCheckbox.parentNode.appendChild(errorDiv);
            }
          } else if (termsCheckbox) {
            termsCheckbox.classList.remove('is-invalid');

          // Remove error message if it exists
            const errorDiv = termsCheckbox.nextElementSibling.nextElementSibling;
            if (errorDiv && errorDiv.classList.contains('invalid-feedback')) {
              errorDiv.remove();
            }
          }

          if (!isValid) {
            event.preventDefault();

          // Scroll to the first invalid field
            const firstInvalidField = addListingForm.querySelector('.is-invalid');
            if (firstInvalidField) {
              firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
              firstInvalidField.focus();
            }
          }
        });
      }

    // Helper function to get CSRF token from cookies (for AJAX requests)
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }

    // Handle URL hash for direct tab access
      const hash = window.location.hash;
      if (hash) {
        const tabId = hash.replace('#', '');
        const tab = document.querySelector(`#account-tabs a[href="#${tabId}"]`);
        if (tab) {
        // Simulate click on the tab
          tab.click();
        }
      }

    // Update URL hash when tab changes
      const tabLinks = document.querySelectorAll('#account-tabs a[data-bs-toggle="tab"]');
      tabLinks.forEach(link => {
        link.addEventListener('shown.bs.tab', function(event) {
          const targetId = event.target.getAttribute('href').replace('#', '');
          window.history.replaceState(null, null, `#${targetId}`);
        });
      });
    });

    // Handle delete confirmation
    const deleteConfirmInput = document.getElementById('deleteConfirm');
    const deletePasswordInput = document.getElementById('deletePassword');
    const deleteButton = document.querySelector('#deleteModal .btn-danger');

    function checkDeleteForm() {
      if (deleteConfirmInput.value === 'DELETE' && deletePasswordInput.value.length > 0) {
        deleteButton.disabled = false;
      } else {
        deleteButton.disabled = true;
      }
    }

    if (deleteConfirmInput && deletePasswordInput && deleteButton) {
      deleteConfirmInput.addEventListener('input', checkDeleteForm);
      deletePasswordInput.addEventListener('input', checkDeleteForm);
    }
  </script>

{% endblock %}